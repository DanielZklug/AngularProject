<ion-header>
  <ion-toolbar>
    <ion-title>cart</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button (click)="startScan()">
        <ion-icon name="scan-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  @if(model){
    @for(item of model?.items; track $index){
      <ion-card>
        <ion-item>
          <ion-thumbnail>
            <ion-img [src]="item?.cover"></ion-img>
          </ion-thumbnail>

          <ion-label>
            {{item?.name}}
            <p>
              <ion-text>
                <strong>{{item?.price}} {{currency}}</strong>
              </ion-text>
            </p>
          </ion-label>

          <ion-row>
            <ion-col>
              <ion-button
              fill="clear"
              (click)="substractQuantity(item)"
              >
              <ion-icon slot="icon-only" name="remove"></ion-icon>
            </ion-button>
            </ion-col>

            <ion-col class="quantity">
              <ion-text>
                <strong>{{item?.quantity}}</strong>
              </ion-text>
            </ion-col>

            <ion-col>
              <ion-button
              fill="clear"
              (click)="addQuantity(item)"
              >
              <ion-icon slot="icon-only" name="add"></ion-icon>
            </ion-button>
            </ion-col>
          </ion-row>
        </ion-item>
      </ion-card>
    }

    <ion-list>
      <ion-item>
        <ion-label></ion-label>
        <ion-text>
          <strong>{{model?.grandTotal | number:'0.2-2'}} {{currency}}</strong>
        </ion-text>
      </ion-item>
    </ion-list>
  }@else {
    <div align="center" class="empty-screen">
      <ion-icon name="cart-outline"></ion-icon>
      <p>No items added yet</p>
    </div>
  }

  @if(model){
    <div class="ion-margin">
      <ion-button
      expand="block"
      mode="ios"
      (click)="isQrPay = true"
      >
        Proceed to Checkout
      </ion-button>
    </div>
  }

  <ion-modal
  #qrcode_modal
  [isOpen]="isQrPay"
  (didDismiss)="isQrPay = false"
  >
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Pay {{model?.grandTotal}} {{currency}}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="qrcode_modal.dismiss()">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <div class="ion-margin" align="center">
        <ion-label>Scan QR Code</ion-label>

        <qrcode [qrdata]="(model.grandTotal).toString()" [width]="256" [errorCorrectionLevel]="'M'"></qrcode>
      </div>

      <div class="ion-margin">
        <ion-button
        expand="block"
        (click)="pay(qrcode_modal)"
        >
          Scan & Pay
        </ion-button>
      </div>
    </ion-content>
  </ng-template>
  </ion-modal>
</ion-content>
