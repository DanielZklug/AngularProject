<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>{{'history.title' | translate}}</ion-title>
    <ion-buttons slot="start">
      <ion-back-button [text]="'home.backButton' | translate" defaultHref="/home"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-list>
    @if(couponsTable.length > 0){
      @for (item of couponsTable; track $index) {
        <ion-item-sliding>
          <ion-item>
            <ion-label class="coupon-label">
              <div class="coupon-header">
                <span class="coupon-title">Coupon  {{item.name !== '' ? `${'history.text' | translate} ${item.name}` : ''}}</span>
                <ion-text [color]="item.status === '1' ? 'success' : 'danger'" class="coupon-status">{{item.status === '1' ? ('history.active' | translate) : ('history.used' | translate)}}</ion-text>
              </div>
              <div class="coupon-price">
                <ion-text color="primary">{{item.amount}} {{couponCurrency}}</ion-text>
              </div>
              <div class="coupon-details">
                <p>{{item.create_at | date:'medium':undefined:('history.lang' | translate)}}</p>
              </div>
            </ion-label>
            <ion-button slot="end" fill="clear" color="white" (click)="activeQR(item)">
              <ion-icon slot="icon-only" name="barcode-outline"></ion-icon>
            </ion-button>
          </ion-item>
          <ion-item-options>
            <ion-item-option  (click)="presentAlert(item.id)" color="danger">{{'history.delete' | translate}}</ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      }
    }@else {
      <div align="center" class="empty-screen">
        <ion-icon name="ticket-outline"></ion-icon>
        <p>{{'history.empty' | translate}}</p>
      </div>
    }
  </ion-list>

  <ion-modal
  #qrcode_modal
  [isOpen]="couponQr"
  (didDismiss)="couponQr = false"
  >
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="end">
          <ion-button (click)="qrcode_modal.dismiss()">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <div class="ion-margin" align="center">
        <ion-label>Scan QR Code</ion-label>
        <br>
        <qrcode [qrdata]="couponQrJsonData" [width]="256" [errorCorrectionLevel]="'M'"></qrcode>
      </div>
    </ion-content>
  </ng-template>
  </ion-modal>
</ion-content>
